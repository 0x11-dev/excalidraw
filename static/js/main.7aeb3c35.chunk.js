(this.webpackJsonpreact=this.webpackJsonpreact||[]).push([[0],{10:function(e,t,n){e.exports=n(11)},11:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n(1),o=n(4),i=n(3),l=n(5),c=n(6),u=n(2),s=n.n(u),d=n(7),f=n.n(d),h=n(8),p=(n(16),Array.of());function g(e,t,n,r,a,o){var i,l,c=a-n,u=o-r,s=c*c+u*u,d=-1;0!==s&&(d=((e-n)*c+(t-r)*u)/s),d<0?(i=n,l=r):d>1?(i=a,l=o):(i=n+d*c,l=r+d*u);var f=e-i,h=t-l;return Math.sqrt(f*f+h*h)}function y(e,t,n){var r=t.fillStyle;"string"===typeof n?(t.fillStyle=n,t.fillRect(-.5,-.5,R.width,R.height)):t.clearRect(-.5,-.5,R.width,R.height),t.fillStyle=r,p.forEach((function(n){if(n.draw(e,t),n.isSelected){var r=S(n),a=b(n),o=C(n),i=B(n),l=t.getLineDash();t.setLineDash([8,4]),t.strokeRect(r-4,o-4,a-r+8,i-o+8),t.setLineDash(l)}}))}function m(e){var t=e.exportBackground,n=e.exportVisibleOnly,r=e.exportPadding,a=void 0===r?10:r,o=e.viewBackgroundColor;if(!p.length)return window.alert("Cannot export empty canvas.");D(),f.a.render(s.a.createElement(V,null),K,(function(){var e=1/0,r=0,i=1/0,l=0;p.forEach((function(t){e=Math.min(e,S(t)),r=Math.max(r,b(t)),i=Math.min(i,C(t)),l=Math.max(l,B(t))}));var c=document.createElement("canvas"),u=c.getContext("2d");c.style.display="none",document.body.appendChild(c),c.width=n?r-e+2*a:R.width,c.height=n?l-i+2*a:R.height,t||y(N,J,null),u.drawImage(R,n?e-a:0,n?i-a:0,n?r-e+2*a:R.width,n?l-i+2*a:R.height,0,0,n?c.width:R.width,n?c.height:R.height),t||y(N,J,o);var s=document.createElement("a");s.setAttribute("download","excalibur.png"),s.setAttribute("href",c.toDataURL("image/png")),s.click(),s.remove(),c!==R&&c.remove()}))}function v(e,t,n,r,a){return[(e-n)*Math.cos(a)-(t-r)*Math.sin(a)+n,(e-n)*Math.sin(a)+(t-r)*Math.cos(a)+r]}var w=h.a.generator(null,null);function x(e){return"text"===e.type}function k(e){var t=e.width,n=e.height,r=Math.sqrt(Math.pow(t-0,2)+Math.pow(n-0,2)),a=Math.min(30,r/2),o=t-(t-0)/r*a,i=n-(n-0)/r*a,l=v(o,i,t,n,-20*Math.PI/180),u=Object(c.a)(l,2),s=u[0],d=u[1],f=v(o,i,t,n,20*Math.PI/180),h=Object(c.a)(f,2);return[0,0,t,n,s,d,h[0],h[1]]}function E(e){if("selection"===e.type)e.draw=function(t,n){var r=n.fillStyle;n.fillStyle="rgba(0, 0, 255, 0.10)",n.fillRect(e.x,e.y,e.width,e.height),n.fillStyle=r};else if("rectangle"===e.type){var t=w.rectangle(0,0,e.width,e.height,{stroke:e.strokeColor,fill:e.backgroundColor});e.draw=function(n,r){r.translate(e.x,e.y),n.draw(t),r.translate(-e.x,-e.y)}}else if("ellipse"===e.type){var n=w.ellipse(e.width/2,e.height/2,e.width,e.height,{stroke:e.strokeColor,fill:e.backgroundColor});e.draw=function(t,r){r.translate(e.x,e.y),t.draw(n),r.translate(-e.x,-e.y)}}else{if("arrow"===e.type){var r=k(e),a=Object(c.a)(r,8),o=a[0],i=a[1],l=a[2],u=a[3],s=a[4],d=a[5],f=a[6],h=a[7],p=[w.line(s,d,l,u,{stroke:e.strokeColor}),w.line(o,i,l,u,{stroke:e.strokeColor}),w.line(f,h,l,u,{stroke:e.strokeColor})];return void(e.draw=function(t,n){n.translate(e.x,e.y),p.forEach((function(e){return t.draw(e)})),n.translate(-e.x,-e.y)})}if(!x(e))throw new Error("Unimplemented type "+e.type);e.draw=function(t,n){var r=n.font;n.font=e.font;var a=n.fillStyle;n.fillStyle=e.strokeColor,n.fillText(e.text,e.x,e.y+e.actualBoundingBoxAscent),n.fillStyle=a,n.font=r}}}function S(e){return e.width>=0?e.x:e.x+e.width}function b(e){return e.width>=0?e.x+e.width:e.x}function C(e){return e.height>=0?e.y:e.y+e.height}function B(e){return e.height>=0?e.y+e.height:e.y}function D(){p.forEach((function(e){e.isSelected=!1}))}function O(){for(var e=p.length-1;e>=0;--e)p[e].isSelected&&p.splice(e,1)}var U="ArrowLeft",M="ArrowRight",T="ArrowDown",L="ArrowUp",A="Escape",I="Delete",P="Backspace";function j(e){return e===U||e===M||e===T||e===L}var V=function(e){function t(){var e,n;Object(r.a)(this,t);for(var a=arguments.length,l=new Array(a),c=0;c<a;c++)l[c]=arguments[c];return(n=Object(o.a)(this,(e=Object(i.a)(t)).call.apply(e,[this].concat(l)))).state={draggingElement:null,elementType:"selection",exportBackground:!1,exportVisibleOnly:!0,exportPadding:10,currentItemStrokeColor:"#000000",currentItemBackgroundColor:"#ffffff",viewBackgroundColor:"#ffffff"},n.onKeyDown=function(e){if("INPUT"!==e.target.nodeName)if(e.key===A)D(),n.forceUpdate(),e.preventDefault();else if(e.key===P||e.key===I)O(),n.forceUpdate(),e.preventDefault();else if(j(e.key)){var t=e.shiftKey?5:1;p.forEach((function(n){n.isSelected&&(e.key===U?n.x-=t:e.key===M?n.x+=t:e.key===L?n.y-=t:e.key===T&&(n.y+=t))})),n.forceUpdate(),e.preventDefault()}else"a"===e.key&&e.metaKey&&(p.forEach((function(e){e.isSelected=!0})),n.forceUpdate(),e.preventDefault())},n}return Object(l.a)(t,e),Object(a.a)(t,[{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.onKeyDown,!1)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.onKeyDown,!1)}},{key:"renderOption",value:function(e){var t=this,n=e.type,r=e.children;return s.a.createElement("label",null,s.a.createElement("input",{type:"radio",checked:this.state.elementType===n,onChange:function(){t.setState({elementType:n}),D(),t.forceUpdate()}}),r)}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{onCut:function(t){t.clipboardData.setData("text/plain",JSON.stringify(p.filter((function(e){return e.isSelected})))),O(),e.forceUpdate(),t.preventDefault()},onCopy:function(e){e.clipboardData.setData("text/plain",JSON.stringify(p.filter((function(e){return e.isSelected})))),e.preventDefault()},onPaste:function(t){var n,r=t.clipboardData.getData("text");try{n=JSON.parse(r)}catch(t){}Array.isArray(n)&&n.length>0&&n[0].type&&(D(),n.forEach((function(e){e.x+=10,e.y+=10,E(e),p.push(e)})),e.forceUpdate()),t.preventDefault()}},s.a.createElement("fieldset",null,s.a.createElement("legend",null,"Shapes"),this.renderOption({type:"rectangle",children:"Rectangle"}),this.renderOption({type:"ellipse",children:"Ellipse"}),this.renderOption({type:"arrow",children:"Arrow"}),this.renderOption({type:"text",children:"Text"}),this.renderOption({type:"selection",children:"Selection"})),s.a.createElement("canvas",{id:"canvas",width:window.innerWidth,height:window.innerHeight-200,onMouseDown:function(t){var n=t.clientX-t.target.offsetLeft,r=t.clientY-t.target.offsetTop,a=function(e,t,n,r,a){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,l={type:e,x:t,y:n,width:o,height:i,isSelected:!1,strokeColor:r,backgroundColor:a,draw:function(e,t){}};return l}(e.state.elementType,n,r,e.state.currentItemStrokeColor,e.state.currentItemBackgroundColor),o=!1,i=document.documentElement.style.cursor;if("selection"===e.state.elementType){var l=p.find((function(e){return function(e,t,n){if("rectangle"===e.type||"ellipse"===e.type){var r=S(e),a=b(e),o=C(e),i=B(e);return g(t,n,r,o,a,o)<10||g(t,n,a,o,a,i)<10||g(t,n,a,i,r,i)<10||g(t,n,r,i,r,o)<10}if("arrow"===e.type){var l=k(e),u=Object(c.a)(l,8),s=u[0],d=u[1],f=u[2],h=u[3],p=u[4],y=u[5],m=u[6],v=u[7];return g(t-=e.x,n-=e.y,p,y,f,h)<10||g(t,n,s,d,f,h)<10||g(t,n,m,v,f,h)<10}if("text"===e.type){var w=S(e),x=b(e),E=C(e),D=B(e);return t>=w&&t<=x&&n>=E&&n<=D}throw new Error("Unimplemented type "+e.type)}(e,n,r)}));l?l.isSelected||(t.shiftKey||D(),l.isSelected=!0):D(),(o=p.some((function(e){return e.isSelected})))&&(document.documentElement.style.cursor="move")}if(x(a)){var u=prompt("What text do you want?");if(null===u)return;a.text=u,a.font="20px Virgil";var s=J.font;J.font=a.font;var d=J.measureText(a.text),f=d.actualBoundingBoxAscent,h=d.actualBoundingBoxDescent,y=d.width;a.actualBoundingBoxAscent=f,J.font=s;var m=f+h;a.x-=y/2,a.y-=f,a.width=y,a.height=m}E(a),p.push(a),"text"===e.state.elementType?(e.setState({draggingElement:null,elementType:"selection"}),a.isSelected=!0):e.setState({draggingElement:a});var v=n,w=r,O=function(t){var n=t.target;if(n instanceof HTMLElement){if(o){var r=p.filter((function(e){return e.isSelected}));if(r.length){var a=t.clientX-n.offsetLeft,i=t.clientY-n.offsetTop;return r.forEach((function(e){e.x+=a-v,e.y+=i-w})),v=a,w=i,void e.forceUpdate()}}var l=e.state.draggingElement;if(l){var c=t.clientX-n.offsetLeft-l.x,u=t.clientY-n.offsetTop-l.y;l.width=c,l.height=t.shiftKey?c:u,E(l),"selection"===e.state.elementType&&function(e){var t=S(e),n=b(e),r=C(e),a=B(e);p.forEach((function(e){var o=S(e),i=b(e),l=C(e),c=B(e);e.isSelected="selection"!==e.type&&t<=o&&r<=l&&n>=i&&a>=c}))}(l),e.forceUpdate()}}};window.addEventListener("mousemove",O),window.addEventListener("mouseup",(function t(n){var r=e.state,a=r.draggingElement,l=r.elementType;if(window.removeEventListener("mousemove",O),window.removeEventListener("mouseup",t),document.documentElement.style.cursor=i,null===a)return D(),void e.forceUpdate();"selection"===l?(o&&(o=!1),p.pop()):a.isSelected=!0,e.setState({draggingElement:null,elementType:"selection"}),e.forceUpdate()})),e.forceUpdate()}}),s.a.createElement("fieldset",null,s.a.createElement("legend",null,"Colors"),s.a.createElement("label",null,s.a.createElement("input",{type:"color",value:this.state.viewBackgroundColor,onChange:function(t){e.setState({viewBackgroundColor:t.target.value})}}),"Background"),s.a.createElement("label",null,s.a.createElement("input",{type:"color",value:this.state.currentItemStrokeColor,onChange:function(t){e.setState({currentItemStrokeColor:t.target.value})}}),"Shape Stroke"),s.a.createElement("label",null,s.a.createElement("input",{type:"color",value:this.state.currentItemBackgroundColor,onChange:function(t){e.setState({currentItemBackgroundColor:t.target.value})}}),"Shape Background")),s.a.createElement("fieldset",null,s.a.createElement("legend",null,"Export"),s.a.createElement("button",{onClick:function(){m({exportBackground:e.state.exportBackground,exportVisibleOnly:e.state.exportVisibleOnly,exportPadding:e.state.exportPadding,viewBackgroundColor:e.state.viewBackgroundColor})}},"Export to png"),s.a.createElement("label",null,s.a.createElement("input",{type:"checkbox",checked:this.state.exportBackground,onChange:function(t){e.setState({exportBackground:t.target.checked})}}),"background"),s.a.createElement("label",null,s.a.createElement("input",{type:"checkbox",checked:this.state.exportVisibleOnly,onChange:function(t){e.setState({exportVisibleOnly:t.target.checked})}}),"visible area only"),"(padding:",s.a.createElement("input",{type:"number",value:this.state.exportPadding,onChange:function(t){e.setState({exportPadding:Number(t.target.value)})},disabled:!this.state.exportVisibleOnly}),"px)"))}},{key:"componentDidUpdate",value:function(){y(N,J,this.state.viewBackgroundColor)}}]),t}(s.a.Component),K=document.getElementById("root");f.a.render(s.a.createElement(V,null),K);var R=document.getElementById("canvas"),N=h.a.canvas(R),J=R.getContext("2d");J.translate(.5,.5),f.a.render(s.a.createElement(V,null),K)},16:function(e,t,n){}},[[10,1,2]]]);
//# sourceMappingURL=main.7aeb3c35.chunk.js.map